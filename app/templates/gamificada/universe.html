{% extends 'base.html' %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/universe.css') }}">
{% endblock %}

{% block content %}
<div class="universe-container theme-{{ area_name }}">
    <header class="universe-header">
        <h1>{{ area_title }}</h1>
        <div class="controls">
            <button id="btnFull" class="ctrl-btn">üïπÔ∏è Tela Cheia</button>
            <button id="btnMute" class="ctrl-btn">üîä Som</button>
            <span class="hint">Use WASD ou setas para se mover</span>
        </div>
    </header>

    <main class="universe-main">
        <div class="viewport" id="viewport">
            <div id="mapLayer" class="map-layer {{ 'map-inicial' if area_name == 'inicial' else 'map-campus' }}">
                {% if area_name == 'inicial' %}
                    <!-- MAPA INICIAL -->
                    <div class="background" style="background-image: url('{{ url_for('static', filename='img/inicial/mapa.jpg') }}');"></div>

                    <img class="npc" src="{{ url_for('static', filename='img/avatar/npc.png') }}" alt="NPC Jonas" style="left: 500px; top: 550px; width: 80px; height: 120px;">

                    <div class="zone zone-jax" title="Universo JAX" data-name="Universo JAX">
                        <img src="{{ url_for('static', filename='img/inicial/arte_jax.jpg') }}" alt="Universo JAX">
                        <div class="zone-label">Universo JAX</div>
                    </div>

                    <div class="zone zone-educacional" data-link="/educacional" data-name="√Årea Educacional">
                        <img src="{{ url_for('static', filename='img/inicial/escola.jpg') }}" alt="√Årea Educacional">
                        <div class="zone-label">√Årea Educacional</div>
                    </div>

                    <div class="zone zone-empresarial" data-link="/empresarial" data-name="√Årea Empresarial">
                        <img src="{{ url_for('static', filename='img/inicial/empresa.jpg') }}" alt="√Årea Empresarial">
                        <div class="zone-label">√Årea Empresarial</div>
                    </div>

                    <div class="zone zone-entretenimento" data-link="/entretenimento" data-name="√Årea de Entretenimento">
                        <img src="{{ url_for('static', filename='img/inicial/entretenimento.jpg') }}" alt="√Årea de Entretenimento">
                        <div class="zone-label">√Årea de Entretenimento</div>
                    </div>

                    <div class="zone zone-impacto" data-link="/jax_jornada" data-name="Impacto Social">
                        <img src="{{ url_for('static', filename='img/inicial/brasil.jpg') }}" alt="Impacto Social">
                        <div class="zone-label">Como o JAX muda o Brasil?</div>
                    </div>

                {% elif area_name == 'educacional' %}
                    <!-- CAMPUS EDUCACIONAL -->
                    <div class="layer bg far" style="background-image:url('{{ url_for('static', filename='img/campus/corredor.jpg') }}');"></div>
                    <div class="layer bg mid" style="background-image:url('{{ url_for('static', filename='img/campus/corredor.jpg') }}'); opacity:0.9;"></div>

                    <div class="zone zone-park" data-zone="park" data-allowed="true" data-name="Entrada">
                        <img src="{{ url_for('static', filename='img/campus/entrada.jpg') }}" alt="Entrada">
                        <div class="zone-label">Entrada</div>
                    </div>

                    <!-- ZONA DE SA√çDA -->
                    <div class="zone zone-exit" data-link="/home" data-name="Voltar ao In√≠cio" style="left: 50px; top: 50px; width: 120px; height: 80px;">
                        <img src="{{ url_for('static', filename='img/inicial/saida.png') }}" alt="Voltar ao In√≠cio">
                        <div class="zone-label">Sair</div>
                    </div>

                    <div class="zone zone-classroom" data-zone="classroom" data-allowed="true" data-name="Sala de Aula">
                        <img src="{{ url_for('static', filename='img/campus/sala-aula.jpg') }}" alt="Sala de Aula">
                        <div class="zone-label">Sala de Aula</div>
                    </div>

                    <div class="zone zone-mural" data-zone="mural" data-allowed="{{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }}" data-name="Mural Oficial">
                        <img src="{{ url_for('static', filename='img/campus/mural_projetos.jpg') }}" alt="Mural">
                        <div class="zone-label">Mural Oficial</div>
                    </div>

                    <div class="zone zone-director" data-zone="director" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}" data-name="Diretoria">
                        <img src="{{ url_for('static', filename='img/campus/diretoria.jpg') }}" alt="Diretoria">
                        <div class="zone-label">Sala da Diretoria</div>
                    </div>

                    <div class="zone zone-teachers" data-zone="teachers" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}" data-name="Sala dos Professores">
                        <img src="{{ url_for('static', filename='img/campus/sala-professores.png') }}" alt="Sala dos Professores">
                        <div class="zone-label">Sala dos Professores</div>
                    </div>

                    <img class="npc" src="{{ url_for('static', filename='img/avatar/npc.png') }}" alt="NPC" style="left: 700px; top: 420px;">

                {% elif area_name == 'empresarial' %}
                    <!-- EMPRESARIAL -->
                    <div class="layer bg far" style="background-image:url('{{ url_for('static', filename='img/empresa/empresa.jpg') }}');"></div>
                    <div class="layer bg mid" style="background-image:url('{{ url_for('static', filename='img/empresa/empresa.jpg') }}'); opacity:0.9;"></div>

                    <div class="zone zone-recepcao" data-zone="recepcao" data-allowed="true" data-name="Recep√ß√£o">
                        <img src="{{ url_for('static', filename='img/empresa/recepcao.jpg') }}" alt="Recep√ß√£o">
                        <div class="zone-label">Recep√ß√£o</div>
                    </div>

                    <!-- ZONA DE SA√çDA -->
                    <div class="zone zone-exit" data-link="/home" data-name="Voltar ao In√≠cio" style="left: 50px; top: 50px; width: 120px; height: 80px;">
                        <img src="{{ url_for('static', filename='img/inicial/saida.png') }}" alt="Voltar ao In√≠cio">
                        <div class="zone-label">Sair</div>
                    </div>

                    <div class="zone zone-coworking" data-zone="coworking" data-allowed="true" data-name="Coworking">
                        <img src="{{ url_for('static', filename='img/empresa/sala-coworking.jpg') }}" alt="Coworking">
                        <div class="zone-label">Sala Coworking</div>
                    </div>

                    <div class="zone zone-tecnica" data-zone="tecnica" data-allowed="{{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }}" data-name="Sala T√©cnica">
                        <img src="{{ url_for('static', filename='img/empresa/sala-tecnica.jpg') }}" alt="Sala T√©cnica">
                        <div class="zone-label">Sala T√©cnica</div>
                    </div>

                    <div class="zone zone-pessoas" data-zone="pessoas" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}" data-name="Sala de Pessoas">
                        <img src="{{ url_for('static', filename='img/empresa/sala-pessoas.jpeg') }}" alt="Sala de Pessoas">
                        <div class="zone-label">Sala de Pessoas</div>
                    </div>

                    <div class="zone zone-comercial" data-zone="comercial" data-allowed="{{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }}" data-name="Sala Comercial">
                        <img src="{{ url_for('static', filename='img/empresa/sala-comercial.jpg') }}" alt="Sala Comercial">
                        <div class="zone-label">Sala Comercial</div>
                    </div>

                    <div class="zone zone-reunioes" data-zone="reunioes" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}" data-name="Sala de Reuni√µes">
                        <img src="{{ url_for('static', filename='img/empresa/sala-reunioes.jpg') }}" alt="Sala de Reuni√µes">
                        <div class="zone-label">Sala de Reuni√µes</div>
                    </div>

                    <img class="npc" src="{{ url_for('static', filename='img/avatar/npc.png') }}" alt="NPC" style="left: 700px; top: 420px;">

                {% elif area_name == 'entretenimento' %}
                    <!-- ENTRETENIMENTO -->
                    <div class="layer bg far" style="background-image:url('{{ url_for('static', filename='img/parque/parque_municipal.jpeg') }}');"></div>
                    <div class="layer bg mid" style="background-image:url('{{ url_for('static', filename='img/parque/parque_municipal.jpeg') }}'); opacity:0.9;"></div>

                    <div class="zone zone-entry" data-zone="entry" data-allowed="true" data-name="Entrada">
                        <img src="{{ url_for('static', filename='img/parque/entrada_parque-municipal.jpeg') }}" alt="Entrada do Parque">
                        <div class="zone-label">Entrada</div>
                    </div>

                    <!-- ZONAS DE SA√çDA -->
                    <div class="zone zone-exit" data-link="/home" data-name="Voltar ao In√≠cio" style="left: 50px; top: 50px; width: 120px; height: 80px;">
                        <img src="{{ url_for('static', filename='img/inicial/saida.png') }}" alt="Voltar ao In√≠cio">
                        <div class="zone-label">Sair</div>
                    </div>

                    <div class="zone zone-lake" data-zone="lake" data-allowed="true" data-name="Lago Central">
                        <img src="{{ url_for('static', filename='img/parque/lago-central.jpeg') }}" alt="Lago Central">
                        <div class="zone-label">Lago Central</div>
                    </div>

                    <div class="zone zone-sport" data-zone="sport" data-allowed="true" data-name="Espa√ßo Esporte">
                        <img src="{{ url_for('static', filename='img/parque/espaco-esporte.jpeg') }}" alt="Espa√ßo Esporte">
                        <div class="zone-label">Espa√ßo Esporte</div>
                    </div>

                    <div class="zone zone-culture" data-zone="culture" data-allowed="true" data-name="Espa√ßo Cultura">
                        <img src="{{ url_for('static', filename='img/parque/espaco-cultura.jpg') }}" alt="Espa√ßo Cultura">
                        <div class="zone-label">Espa√ßo Cultura</div>
                    </div>

                    <div class="zone zone-nerd" data-zone="nerd" data-allowed="true" data-name="Espa√ßo Nerd">
                        <img src="{{ url_for('static', filename='img/parque/espaco-nerd.jpg') }}" alt="Espa√ßo Nerd">
                        <div class="zone-label">Espa√ßo Nerd</div>
                    </div>

                    <img class="npc" src="{{ url_for('static', filename='img/avatar/npc.png') }}" alt="NPC" style="left: 700px; top: 420px;">
                {% endif %}

                <!-- PERSONAGEM -->
                <div id="player" class="player">
                    <img src="{{ player_sprite }}" alt="Personagem">
                </div>
            </div>
        </div>

        <!-- PAINEL LATERAL -->
        <aside class="side-panel">
            <div class="panel-block">
                <h3>{% if area_name == 'inicial' %}Bem-vindo{% else %}Localiza√ß√£o{% endif %}</h3>
                {% if area_name == 'inicial' %}
                    {% if current_user %}
                        <p>Ol√°, {{ current_user.username }}!</p>
                    {% else %}
                        <p>Explore o Universo JAX e descubra novas oportunidades.</p>
                        <a href="/login" class="modal-btn" style="display: inline-block; text-decoration: none; margin-top: 10px;">Entrar</a>
                    {% endif %}
                {% else %}
                    <div id="location">{{ default_location }}</div>
                {% endif %}
            </div>

            {% if area_name != 'inicial' %}
            <div class="panel-block">
                <h3>A√ß√µes R√°pidas</h3>
                {% if area_name == 'educacional' %}
                    <button class="tele ctrl-btn" data-target="park">Ir a Entrada</button>
                    <button class="exit-btn ctrl-btn" style="background: #ef4444; color: white; margin-top: 10px;"> üö™ Voltar ao In√≠cio </button>
                    <button class="tele ctrl-btn" data-target="classroom">Ir √† Sala</button>
                    <button class="tele ctrl-btn" data-target="mural" data-allowed="{{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }}">Ir ao Mural</button>
                    <button class="tele ctrl-btn" data-target="director" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}">Ir √† Diretoria</button>
                    <button class="tele ctrl-btn" data-target="teachers" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}">Ir √† Sala dos Professores</button>
                {% elif area_name == 'empresarial' %}
                    <button class="tele ctrl-btn" data-target="recepcao">Ir √† Recep√ß√£o</button>
                    <button class="exit-btn ctrl-btn" style="background: #ef4444; color: white; margin-top: 10px;"> üö™ Voltar ao In√≠cio </button>
                    <button class="tele ctrl-btn" data-target="coworking">Ir ao Coworking</button>
                    <button class="tele ctrl-btn" data-target="tecnica" data-allowed="{{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }}">Ir √† Sala T√©cnica</button>
                    <button class="tele ctrl-btn" data-target="pessoas" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}">Ir √† Sala de Pessoas</button>
                    <button class="tele ctrl-btn" data-target="comercial" data-allowed="{{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }}">Ir √† Sala Comercial</button>
                    <button class="tele ctrl-btn" data-target="reunioes" data-allowed="{{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}">Ir √† Sala de Reuni√µes</button>
                {% elif area_name == 'entretenimento' %}
                    <button class="tele ctrl-btn" data-target="entry">Ir √† Entrada</button>
                    <button class="exit-btn ctrl-btn" style="background: #ef4444; color: white; margin-top: 10px;"> üö™ Voltar ao In√≠cio </button>
                    <button class="tele ctrl-btn" data-target="lake">Ir ao Lago Central</button>
                    <button class="tele ctrl-btn" data-target="sport">Ir ao Espa√ßo Esporte</button>
                    <button class="tele ctrl-btn" data-target="culture">Ir ao Espa√ßo Cultura</button>
                    <button class="tele ctrl-btn" data-target="nerd">Ir ao Espa√ßo Nerd</button>
                {% endif %}
            </div>
            {% endif %}

            <div class="panel-block">
                <h3>Status</h3>
                <div id="statusMsg">{{ welcome_message }}</div>
                <div class="small">Seu acesso:
                    {% if current_user %}
                        {{ current_user.profile }}
                    {% else %}
                        visitante
                    {% endif %}
                </div>
            </div>
        </aside>
    </main>
</div>

<!-- MODAL -->
<div id="welcomeModal" class="modal hidden">
    <div class="modal-content">
        <h2>{{ modal_title }}</h2>
        <p>{{ modal_message }}</p>
        <button id="closeModal" class="modal-btn">Entrar</button>
    </div>
</div>

<!-- MODAL DE USU√ÅRIO GLOBAL -->
<div id="userModal" class="modal hidden">
  <div class="modal-content user-modal">
    <span id="closeUserModal" class="modal-close">&times;</span>
    <h2>Conta de {{ current_user.username if current_user else 'Visitante' }}</h2>

    <div class="modal-links">
      <a href="/perfil" class="modal-btn">üë§ Meu Perfil</a>

      {% if current_user and current_user.profile == 'admin' %}
        <hr>
        <a href="/usuarios" class="modal-btn admin">üë• Usu√°rios</a>
        <a href="/admin/matriculas" class="modal-btn admin">üéì Matr√≠culas</a>
      {% endif %}
    </div>
  </div>
</div>

<!-- MODAL: MURAL OFICIAL -->
<div id="muralModal" class="modal hidden">
  <div class="modal-content">
    <h2>üì∞ Mural Oficial da Escola</h2>
    <div id="muralContent" class="modal-scroll"></div>
    <button id="closeMural" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA DA DIRETORIA -->
<div id="diretoriaModal" class="modal hidden">
  <div class="modal-content">
    <h2>üèõÔ∏è Sala da Diretoria</h2>
    <div id="chatContainer" class="chat-box"></div>
    <div class="chat-input">
      <input id="chatMessage" type="text" placeholder="Digite sua mensagem..." />
      <button id="sendChat" class="modal-btn">Enviar</button>
    </div>
    <button id="closeDiretoria" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA DOS PROFESSORES -->
<div id="teachersModal" class="modal hidden">
  <div class="modal-content">
    <h2>üë®‚Äçüè´ Sala dos Professores</h2>
    <p><em>Espa√ßo para tirar d√∫vidas acad√™micas</em></p>
    
    <div class="duvidas-container">
      <h3>‚ùì Fazer uma Pergunta</h3>
      <form id="formDuvida" method="POST" action="/sala-professores/duvidas">
        <textarea name="pergunta" placeholder="Digite sua d√∫vida acad√™mica..." required class="modal-input" rows="4"></textarea>
        <button type="submit" class="modal-btn">Enviar D√∫vida</button>
      </form>
      
      <hr>
      
      <h3>üìö D√∫vidas Recentes</h3>
      <div id="listaDuvidas" class="modal-scroll">
        {% for duvida in duvidas %}
          <div class="duvida-item">
            <div class="duvida-header">
              <strong>{{ duvida.autor }}</strong> - <small>{{ duvida.data }}</small>
            </div>
            <div class="duvida-pergunta">
              <strong>P:</strong> {{ duvida.pergunta }}
            </div>
            {% if duvida.resposta %}
              <div class="duvida-resposta">
                <strong>R ({{ duvida.respondido_por }}):</strong> {{ duvida.resposta }}
              </div>
            {% else %}
              <div class="duvida-pendente">
                <em>‚åõ Aguardando resposta...</em>
                {% if current_user and current_user.profile in ['admin','funcionario'] %}
                <form method="POST" action="/sala-professores/responder" style="margin-top: 10px;">
                  <input type="hidden" name="duvida_id" value="{{ duvida.id }}">
                  <textarea name="resposta" placeholder="Digite a resposta..." class="modal-input" rows="2"></textarea>
                  <button type="submit" class="modal-btn">Responder</button>
                </form>
                {% endif %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
    
    <button id="closeTeachers" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA DE AULA -->
<div id="classroomModal" class="modal hidden">
  <div class="modal-content">
    <h2>üè´ Sala de Aula</h2>
    
    <div class="classroom-actions">
      {% if current_user and current_user.profile in ['admin','funcionario'] %}
        <div class="admin-actions">
          <h3>üìù Gerenciar Resumos</h3>
          <a href="/sala-aula/novo-resumo" class="modal-btn">‚ûï Novo Resumo</a>
          <a href="/jaxresume/lista" class="modal-btn">üìã Listar Todos</a>
        </div>
        <hr>
      {% endif %}
      
      <h3>üìö Resumos Dispon√≠veis</h3>
      <div id="listaResumos" class="modal-scroll">
        <!-- Os resumos ser√£o carregados via JavaScript -->
        <div class="loading">Carregando resumos...</div>
      </div>
    </div>
    
    <button id="closeClassroom" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: COWORKING -->
<div id="coworkingModal" class="modal hidden">
  <div class="modal-content">
    <h2>üíº √Årea de Coworking</h2>
    <p><em>Espa√ßo livre para conversas empresariais</em></p>
    
    <div id="coworkingChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="coworkingMessage" type="text" placeholder="Digite sua mensagem sobre neg√≥cios..." />
      <button id="sendCoworking" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeCoworking" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA T√âCNICA -->
<div id="tecnicaModal" class="modal hidden">
  <div class="modal-content">
    <h2>üîß Sala T√©cnica</h2>
    <p><em>Discuss√µes sobre TI, tecnologia e assuntos t√©cnicos</em></p>
    
    <div id="tecnicaChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="tecnicaMessage" type="text" placeholder="Digite sobre tecnologia, TI, desenvolvimento..." />
      <button id="sendTecnica" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeTecnica" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA DE PESSOAS -->
<div id="pessoasModal" class="modal hidden">
  <div class="modal-content">
    <h2>üë• Sala de Pessoas</h2>
    <p><em>Assuntos de RH, administra√ß√£o e gest√£o de pessoas</em></p>
    
    <div id="pessoasChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="pessoasMessage" type="text" placeholder="Digite sobre RH, administra√ß√£o..." />
      <button id="sendPessoas" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closePessoas" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA COMERCIAL -->
<div id="comercialModal" class="modal hidden">
  <div class="modal-content">
    <h2>üìä Sala Comercial</h2>
    <p><em>Vendas, negocia√ß√µes e estrat√©gias comerciais</em></p>
    
    <div id="comercialChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="comercialMessage" type="text" placeholder="Digite sobre vendas, neg√≥cios..." />
      <button id="sendComercial" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeComercial" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: SALA DE REUNI√ïES -->
<div id="reunioesModal" class="modal hidden">
  <div class="modal-content">
    <h2>ü§ù Sala de Reuni√µes</h2>
    <p><em>Espa√ßo para reuni√µes focadas (1 hora de dura√ß√£o)</em></p>
    
    <div class="reuniao-info">
      <p><strong>‚è∞ Dura√ß√£o:</strong> 60 minutos</p>
      <p><strong>üë• Acesso:</strong> Apenas membros espec√≠ficos</p>
    </div>
    
    <div id="reunioesChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="reunioesMessage" type="text" placeholder="Mensagem para a reuni√£o..." />
      <button id="sendReunioes" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeReunioes" class="modal-btn">Sair da Reuni√£o</button>
  </div>
</div>

<!-- MODAL: LAGO CENTRAL -->
<div id="lakeModal" class="modal hidden">
  <div class="modal-content">
    <h2>üåä Lago Central</h2>
    <p><em>√Årea livre para conversas sobre entretenimento</em></p>
    
    <div id="lakeChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="lakeMessage" type="text" placeholder="Converse sobre qualquer tema de entretenimento..." />
      <button id="sendLake" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeLake" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: ESPA√áO ESPORTE -->
<div id="sportModal" class="modal hidden">
  <div class="modal-content">
    <h2>‚öΩ Espa√ßo Esporte</h2>
    <p><em>Somente conversas sobre esportes</em></p>
    
    <div id="sportChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="sportMessage" type="text" placeholder="Digite sobre futebol, basquete, F1..." />
      <button id="sendSport" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeSport" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: ESPA√áO CULTURA -->
<div id="cultureModal" class="modal hidden">
  <div class="modal-content">
    <h2>üé≠ Espa√ßo Cultura</h2>
    <p><em>Eventos culturais, exposi√ß√µes, teatro, m√∫sica</em></p>
    
    <div id="cultureChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="cultureMessage" type="text" placeholder="Digite sobre eventos culturais..." />
      <button id="sendCulture" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeCulture" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: ESPA√áO NERD -->
<div id="nerdModal" class="modal hidden">
  <div class="modal-content">
    <h2>üéÆ Espa√ßo Nerd</h2>
    <p><em>Games, animes, s√©ries, tecnologia e cultura nerd</em></p>
    
    <div id="nerdChat" class="chat-box"></div>
    <div class="chat-input">
      <input id="nerdMessage" type="text" placeholder="Digite sobre games, animes, s√©ries..." />
      <button id="sendNerd" class="modal-btn">Enviar</button>
    </div>
    
    <button id="closeNerd" class="modal-btn">Fechar</button>
  </div>
</div>

<!-- MODAL: NPC JONAS -->
<div id="jonasModal" class="modal hidden">
  <div class="modal-content">
    <h2>üßô Jonas - O Curioso</h2>
    
    <div class="dialog-container">
      <!-- Di√°logo 1: Apresenta√ß√£o do Jonas -->
      <div id="dialog1" class="dialog-step">
        <div class="npc-speech">
          <p><strong>Jonas:</strong> "Eiiii seu doidinho, n√£o t√° me vendo aqui n√£o?"</p>
        </div>
        <div class="player-options">
          <button class="dialog-btn" data-next="dialog2a">"Desculpa, n√£o vi"</button>
          <button class="dialog-btn" data-next="dialog2b">"Voc√™? Quem √©?"</button>
        </div>
      </div>

      <!-- Di√°logo 2a: Resposta "Desculpa, n√£o vi" -->
      <div id="dialog2a" class="dialog-step hidden">
        <div class="npc-speech">
          <p><strong>Jonas:</strong> "Voc√™ √© bem idiota, sabia? Inclusive, tava pensando aqui, voc√™ sabe como funciona universo JAX?"</p>
        </div>
        <div class="player-options">
          <button class="dialog-btn" data-next="end">"Sim, eu conhe√ßo"</button>
          <button class="dialog-btn" data-next="salas">"N√£o eu n√£o conhe√ßo"</button>
        </div>
      </div>

      <!-- Di√°logo 2b: Resposta "Voc√™? Quem √©?" -->
      <div id="dialog2b" class="dialog-step hidden">
        <div class="npc-speech">
          <p><strong>Jonas:</strong> "Eu sou Jonas um curioso do Universo JAX. Inclusive, tava pensando aqui, voc√™ sabe como funciona universo JAX?"</p>
        </div>
        <div class="player-options">
          <button class="dialog-btn" data-next="end">"Sim, eu conhe√ßo"</button>
          <button class="dialog-btn" data-next="salas">"N√£o eu n√£o conhe√ßo"</button>
        </div>
      </div>

      <!-- Di√°logo 3: Lista de Salas -->
      <div id="salas" class="dialog-step hidden">
        <div class="npc-speech">
          <p><strong>Jonas:</strong> "N√£o tem problema! Deixa eu te explicar as principais √°reas do Universo JAX:"</p>
        </div>
        
        <div class="salas-list">
          <div class="sala-category">
            <h4>üè† √Årea Inicial</h4>
            <ul>
              <li><strong>Universo JAX</strong> - O cora√ß√£o do projeto</li>
              <li><strong>√Årea Educacional</strong> - Cursos e aprendizado</li>
              <li><strong>√Årea Empresarial</strong> - Oportunidades de trabalho</li>
              <li><strong>√Årea Entretenimento</strong> - Divers√£o e lazer</li>
              <li><strong>Como o JAX muda o Brasil?</strong> - Nosso impacto social</li>
            </ul>
          </div>

          <div class="sala-category">
            <h4>üíº √Årea Empresarial</h4>
            <ul>
              <li><strong>Recep√ß√£o</strong> - Primeiro contato</li>
              <li><strong>Coworking</strong> - Espa√ßo colaborativo</li>
              <li><strong>Sala T√©cnica</strong> - Tecnologia e inova√ß√£o</li>
              <li><strong>Sala de Pessoas</strong> - Recursos humanos</li>
              <li><strong>Sala Comercial</strong> - Vendas e neg√≥cios</li>
              <li><strong>Sala de Reuni√µes</strong> - Encontros profissionais</li>
            </ul>
          </div>

          <div class="sala-category">
            <h4>üéì √Årea Educacional</h4>
            <ul>
              <li><strong>Entrada</strong> - Acesso principal</li>
              <li><strong>Sala de Aula</strong> - Aprendizado</li>
              <li><strong>Mural</strong> - Avisos e projetos</li>
              <li><strong>Diretoria</strong> - Administra√ß√£o</li>
              <li><strong>Sala dos Professores</strong> - Suporte educacional</li>
            </ul>
          </div>

          <div class="sala-category">
            <h4>üéÆ √Årea Entretenimento</h4>
            <ul>
              <li><strong>Entrada</strong> - Acesso ao parque</li>
              <li><strong>Lago Central</strong> - Conversas livres</li>
              <li><strong>Espa√ßo Esporte</strong> - Esportes e atividades</li>
              <li><strong>Espa√ßo Cultura</strong> - Arte e eventos</li>
              <li><strong>Espa√ßo Nerd</strong> - Games e cultura pop</li>
            </ul>
          </div>
        </div>

        <div class="player-options">
          <button class="dialog-btn" data-next="end">"Obrigado, Jonas!"</button>
        </div>
      </div>
    </div>

    <button id="closeJonas" class="modal-btn" style="margin-top: 15px;">Fechar</button>
  </div>
</div>

{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/universe-core.js') }}"></script>

<script>
const currentUser = {% if current_user %}{
    username: '{{ current_user.username }}',
    profile: '{{ current_user.profile }}',
    is_authenticated: true
}{% else %}null{% endif %};
</script>

<script>
    // Configura√ß√µes
    {% if area_name == 'educacional' %}
    const PERMS = {
        mural: {{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }},
        director: {{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }},
        teachers: {{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}
    };
    {% elif area_name == 'empresarial' %}
    const PERMS = {
        tecnica: {{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }},
        pessoas: {{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }},
        comercial: {{ 'true' if (current_user and current_user.profile in ['aluno','admin','funcionario']) else 'false' }},
        reunioes: {{ 'true' if (current_user and current_user.profile in ['admin','funcionario']) else 'false' }}
    };
    {% else %}
    const PERMS = {};
    {% endif %}

    // Configura√ß√£o base
    const config = {
        areaName: '{{ area_name }}',
        {% if area_name == 'inicial' %}
        mapSize: { width: 2000, height: 1200 },
        initialPos: { x: 400, y: 550 },
        safePos: { x: 400, y: 550 },
        speed: 4
        {% else %}
        mapSize: { width: 2600, height: 1400 },
        initialPos: { x: 600, y: 400 },
        safePos: { x: 600, y: 400 },
        speed: 3.6,
        defaultLocation: '{{ default_location }}',
        {% if area_name == 'educacional' %}
        triggerModalZone: 'park',
        permissions: {
            park: true, classroom: true,
            mural: PERMS.mural, director: PERMS.director, teachers: PERMS.teachers
        },
        zonePositions: {
            park: { x: 450, y: 300 }, classroom: { x: 1140, y: 290 },
            mural: { x: 450, y: 700 }, director: { x: 1130, y: 650 },
            teachers: { x: 1860, y: 670 }
        }
        {% elif area_name == 'empresarial' %}
        triggerModalZone: 'recepcao',
        permissions: {
            recepcao: true, coworking: true,
            tecnica: PERMS.tecnica, pessoas: PERMS.pessoas,
            comercial: PERMS.comercial, reunioes: PERMS.reunioes
        },
        zonePositions: {
            recepcao: { x: 450, y: 300 }, coworking: { x: 1140, y: 290 },
            tecnica: { x: 450, y: 700 }, pessoas: { x: 1130, y: 650 },
            comercial: { x: 1860, y: 290 }, reunioes: { x: 1860, y: 670 }
        }
        {% elif area_name == 'entretenimento' %}
        permissions: {
            entry: true, lake: true, sport: true, culture: true, nerd: true
        },
        zonePositions: {
            entry: { x: 450, y: 300 }, lake: { x: 1140, y: 290 },
            sport: { x: 450, y: 700 }, culture: { x: 1130, y: 650 },
            nerd: { x: 1860, y: 670 }
        }
        {% endif %}
        {% endif %}
    };

    // Inicializa√ß√£o CORRIGIDA
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Starting {{ area_name }} game with config:', config);
        window.game = window.initGame(config);
    });
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const avatar = document.querySelector('#player img, .navbar-avatar, #avatar-btn'); // cobre poss√≠veis seletores
  const modal = document.getElementById('userModal');
  const closeModal = document.getElementById('closeUserModal');

  if (avatar && modal) {
    avatar.style.cursor = 'pointer';
    avatar.addEventListener('click', () => {
      modal.classList.remove('hidden');
    });
  }

  if (closeModal) {
    closeModal.addEventListener('click', () => {
      modal.classList.add('hidden');
    });
  }

  // Fecha o modal se clicar fora
  window.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.add('hidden');
    }
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const muralModal = document.getElementById('muralModal');
  const muralContent = document.getElementById('muralContent');
  const closeMural = document.getElementById('closeMural');

  // ---- FUN√á√ÉO √öNICA DO MURAL ----
  async function openMural() {
    const res = await fetch('/mural-oficial');
    const avisos = await res.json();

    muralContent.innerHTML = avisos.map(a => `
      <div class="mural-item" data-id="${a.id}">
        <h4>${a.titulo}</h4>
        <p>${a.texto}</p>
        <small>${a.data}</small>
        {% if current_user and current_user.profile == 'admin' %}
        <div class="mural-admin">
          <button class="edit-btn modal-btn">‚úèÔ∏è Editar</button>
          <button class="delete-btn modal-btn" style="background:#ef4444;color:white;">üóëÔ∏è Excluir</button>
        </div>
        {% endif %}
      </div>
    `).join('');

    {% if current_user and current_user.profile == 'admin' %}
    muralContent.insertAdjacentHTML('beforeend', `
      <hr>
      <h3>‚ûï Novo Aviso</h3>
      <input id="newTitulo" placeholder="T√≠tulo" class="modal-input">
      <textarea id="newTexto" placeholder="Texto do aviso" class="modal-input"></textarea>
      <button id="addAviso" class="modal-btn">Publicar</button>
    `);

    // CRIAR NOVO AVISO
    document.getElementById('addAviso').addEventListener('click', async () => {
      const titulo = document.getElementById('newTitulo').value.trim();
      const texto = document.getElementById('newTexto').value.trim();
      if (!titulo || !texto) return alert('Preencha t√≠tulo e texto.');
      await fetch('/mural-oficial', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ titulo, texto })
      });
      openMural();
    });

    // DELETAR
    muralContent.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const id = e.target.closest('.mural-item').dataset.id;
        if (confirm('Deseja apagar este aviso?')) {
          await fetch('/mural-oficial', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: parseInt(id) })
          });
          openMural();
        }
      });
    });

    // EDITAR
    muralContent.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', async (e) => {
        const item = e.target.closest('.mural-item');
        const id = item.dataset.id;
        const titulo = prompt('Novo t√≠tulo:', item.querySelector('h4').innerText);
        const texto = prompt('Novo texto:', item.querySelector('p').innerText);
        if (!titulo || !texto) return;
        await fetch('/mural-oficial', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: parseInt(id), titulo, texto })
        });
        openMural();
      });
    });
    {% endif %}

    muralModal.classList.remove('hidden');
  }

  closeMural.addEventListener('click', () => muralModal.classList.add('hidden'));

  // ---- LIGA√á√ÉO DAS ZONAS ----
  document.querySelectorAll('.zone-mural').forEach(z => {
    z.addEventListener('click', openMural);
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const diretoriaModal = document.getElementById('diretoriaModal');
  const closeDiretoria = document.getElementById('closeDiretoria');
  const chatContainer = document.getElementById('chatContainer');
  const sendChat = document.getElementById('sendChat');
  const chatMessage = document.getElementById('chatMessage');

  // Exemplo de hist√≥rico inicial
  let chatHistory = [
    { user: 'Diretor', text: 'Bem-vindo √† sala da diretoria!' },
    { user: 'Assistente', text: 'Como posso ajudar hoje?' }
  ];

  // Renderizar mensagens
  function renderChat() {
    chatContainer.innerHTML = chatHistory.map(
      msg => `<div class="chat-msg"><strong>${msg.user}:</strong> ${msg.text}</div>`
    ).join('');
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  // Enviar mensagem
  sendChat.addEventListener('click', () => {
    const text = chatMessage.value.trim();
    if (!text) return;
    chatHistory.push({ user: '{{ current_user.username if current_user else "Visitante" }}', text });
    chatMessage.value = '';
    renderChat();
  });

  // Fechar modal
  closeDiretoria.addEventListener('click', () => {
    diretoriaModal.classList.add('hidden');
  });

  // Abrir modal ao clicar na zona da diretoria
  document.querySelectorAll('.zone-director').forEach(zone => {
    zone.addEventListener('click', () => {
      const allowed = zone.dataset.allowed === 'true';
      if (!allowed) {
        alert('üö´ Apenas administradores e funcion√°rios podem entrar na diretoria.');
        return;
      }
      renderChat();
      diretoriaModal.classList.remove('hidden');
    });
  });
});
</script>

<script>
// SALA DOS PROFESSORES
document.addEventListener('DOMContentLoaded', () => {
  const teachersModal = document.getElementById('teachersModal');
  const closeTeachers = document.getElementById('closeTeachers');

  // Abrir modal da sala dos professores
  document.querySelectorAll('.zone-teachers').forEach(zone => {
    zone.addEventListener('click', () => {
      const allowed = zone.dataset.allowed === 'true';
      if (!allowed) {
        alert('üö´ Apenas administradores e funcion√°rios podem acessar a sala dos professores.');
        return;
      }
      teachersModal.classList.remove('hidden');
    });
  });

  closeTeachers.addEventListener('click', () => {
    teachersModal.classList.add('hidden');
  });
});
</script>

<script>
// SALA DE AULA - RESUMOS
document.addEventListener('DOMContentLoaded', () => {
  const classroomModal = document.getElementById('classroomModal');
  const closeClassroom = document.getElementById('closeClassroom');
  const listaResumos = document.getElementById('listaResumos');

  // Carregar resumos ao abrir o modal
    async function carregarResumos() {
        try {
            const response = await fetch('/api/jaxresume/resumos');
            const data = await response.json();
            
            if (data.success) {
                const userCanEdit = data.user_info && data.user_info.can_edit;
                
                if (data.resumos.length === 0) {
                    listaResumos.innerHTML = `
                        <div class="no-resumos">
                            <p>üìö Nenhum resumo dispon√≠vel no momento.</p>
                            ${userCanEdit ? 
                                '<a href="/jaxresume/novo" class="modal-btn">Criar Primeiro Resumo</a>' : 
                                ''
                            }
                        </div>
                    `;
                    return;
                }
                
                listaResumos.innerHTML = data.resumos.map(resumo => `
                    <div class="resumo-item" data-id="${resumo.id}">
                       
                        <div class="resumo-content">
                            <h4>${resumo.titulo}</h4>
                            <p class="resumo-descricao">${resumo.descricao || 'Sem descri√ß√£o'}</p>
                            
                            <div class="resumo-meta">
                                <div class="meta-left">
                                    <small>üìÅ ${resumo.tema}</small>
                                    <small>üë§ ${resumo.autor}</small>
                                </div>
                                <div class="meta-right">
                                    <small>üìÖ ${resumo.data_publicacao || 'Data n√£o informada'}</small>
                                </div>
                            </div>
                            
                            <div class="resumo-actions">
                                <a href="/jaxresume/post/${resumo.id}" class="btn-ler-resumo">
                                    üëÄ Ler Resumo Completo
                                </a>
                                
                                ${userCanEdit ? `
                                    <div class="admin-actions">
                                        <a href="/jaxresume/editar/${resumo.id}" class="btn-editar">‚úèÔ∏è Editar</a>
                                        <button class="btn-remover" onclick="removerResumo(${resumo.id})">üóëÔ∏è Remover</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } else {
                listaResumos.innerHTML = `
                    <div class="error-message">
                        <p>‚ùå Erro ao carregar resumos: ${data.error}</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Erro ao carregar resumos:', error);
            listaResumos.innerHTML = `
                <div class="error-message">
                    <p>‚ùå Erro de conex√£o ao carregar resumos.</p>
                </div>
            `;
        }
    }

    // Fun√ß√£o para remover resumo (apenas admin/funcion√°rios)
    async function removerResumo(resumoId) {
        if (!confirm('Tem certeza que deseja remover este resumo?')) return;
        
        try {
            const response = await fetch(`/jaxresume/remover/${resumoId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            if (response.ok) {
                // Recarregar a lista
                carregarResumos();
            } else {
                alert('Erro ao remover resumo.');
            }
        } catch (error) {
            console.error('Erro ao remover resumo:', error);
            alert('Erro ao remover resumo.');
        }
    }

  // Abrir modal da sala de aula
  document.querySelectorAll('.zone-classroom').forEach(zone => {
    zone.addEventListener('click', () => {
      classroomModal.classList.remove('hidden');
      carregarResumos();
    });
  });

  closeClassroom.addEventListener('click', () => {
    classroomModal.classList.add('hidden');
  });
});
</script>

<script>
// SALAS EMPRESARIAIS
document.addEventListener('DOMContentLoaded', () => {
  
  // COWORKING
  const setupChatModal = (modalId, chatId, inputId, sendId, closeId, welcomeMessage) => {
    const modal = document.getElementById(modalId);
    const chat = document.getElementById(chatId);
    const input = document.getElementById(inputId);
    const sendBtn = document.getElementById(sendId);
    const closeBtn = document.getElementById(closeId);

    let chatHistory = [
      { user: 'Sistema', text: welcomeMessage }
    ];

    function renderChat() {
      chat.innerHTML = chatHistory.map(
        msg => `<div class="chat-msg"><strong>${msg.user}:</strong> ${msg.text}</div>`
      ).join('');
      chat.scrollTop = chat.scrollHeight;
    }

    sendBtn.addEventListener('click', () => {
      const text = input.value.trim();
      if (!text) return;
      chatHistory.push({ 
        user: '{{ current_user.username if current_user else "Visitante" }}', 
        text 
      });
      input.value = '';
      renderChat();
    });

    closeBtn.addEventListener('click', () => {
      modal.classList.add('hidden');
    });

    return { modal, renderChat };
  };

  // Configurar todas as salas empresariais
  const salasEmpresariais = {
    coworking: setupChatModal(
      'coworkingModal', 'coworkingChat', 'coworkingMessage', 'sendCoworking', 'closeCoworking',
      'Bem-vindo ao Coworking! Converse sobre qualquer tema empresarial.'
    ),
    tecnica: setupChatModal(
      'tecnicaModal', 'tecnicaChat', 'tecnicaMessage', 'sendTecnica', 'closeTecnica',
      'Bem-vindo √† Sala T√©cnica! Discuss√µes sobre TI e tecnologia.'
    ),
    pessoas: setupChatModal(
      'pessoasModal', 'pessoasChat', 'pessoasMessage', 'sendPessoas', 'closePessoas',
      'Bem-vindo √† Sala de Pessoas! Assuntos de RH e administra√ß√£o.'
    ),
    comercial: setupChatModal(
      'comercialModal', 'comercialChat', 'comercialMessage', 'sendComercial', 'closeComercial',
      'Bem-vindo √† Sala Comercial! Vendas e negocia√ß√µes.'
    ),
    reunioes: setupChatModal(
      'reunioesModal', 'reunioesChat', 'reunioesMessage', 'sendReunioes', 'closeReunioes',
      'Bem-vindo √† Sala de Reuni√µes! Reuni√£o focada por 1 hora.'
    )
  };

  // Configurar salas de entretenimento
  const salasEntretenimento = {
    lake: setupChatModal(
      'lakeModal', 'lakeChat', 'lakeMessage', 'sendLake', 'closeLake',
      'Bem-vindo ao Lago Central! Converse sobre qualquer tema de entretenimento.'
    ),
    sport: setupChatModal(
      'sportModal', 'sportChat', 'sportMessage', 'sendSport', 'closeSport',
      'Bem-vindo ao Espa√ßo Esporte! Aqui s√≥ falamos sobre esportes.'
    ),
    culture: setupChatModal(
      'cultureModal', 'cultureChat', 'cultureMessage', 'sendCulture', 'closeCulture',
      'Bem-vindo ao Espa√ßo Cultura! Eventos e manifesta√ß√µes culturais.'
    ),
    nerd: setupChatModal(
      'nerdModal', 'nerdChat', 'nerdMessage', 'sendNerd', 'closeNerd',
      'Bem-vindo ao Espa√ßo Nerd! Games, animes, s√©ries e cultura nerd.'
    )
  };

  // Ligar zonas aos modais - EMPRESARIAL
  document.querySelectorAll('.zone-coworking').forEach(zone => {
    zone.addEventListener('click', () => {
      salasEmpresariais.coworking.renderChat();
      salasEmpresariais.coworking.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-tecnica').forEach(zone => {
    zone.addEventListener('click', () => {
      const allowed = zone.dataset.allowed === 'true';
      if (!allowed) {
        alert('üö´ Acesso n√£o permitido √† Sala T√©cnica.');
        return;
      }
      salasEmpresariais.tecnica.renderChat();
      salasEmpresariais.tecnica.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-pessoas').forEach(zone => {
    zone.addEventListener('click', () => {
      const allowed = zone.dataset.allowed === 'true';
      if (!allowed) {
        alert('üö´ Acesso n√£o permitido √† Sala de Pessoas.');
        return;
      }
      salasEmpresariais.pessoas.renderChat();
      salasEmpresariais.pessoas.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-comercial').forEach(zone => {
    zone.addEventListener('click', () => {
      const allowed = zone.dataset.allowed === 'true';
      if (!allowed) {
        alert('üö´ Acesso n√£o permitido √† Sala Comercial.');
        return;
      }
      salasEmpresariais.comercial.renderChat();
      salasEmpresariais.comercial.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-reunioes').forEach(zone => {
    zone.addEventListener('click', () => {
      const allowed = zone.dataset.allowed === 'true';
      if (!allowed) {
        alert('üö´ Acesso n√£o permitido √† Sala de Reuni√µes.');
        return;
      }
      salasEmpresariais.reunioes.renderChat();
      salasEmpresariais.reunioes.modal.classList.remove('hidden');
    });
  });

  // Ligar zonas aos modais - ENTRETENIMENTO
  document.querySelectorAll('.zone-lake').forEach(zone => {
    zone.addEventListener('click', () => {
      salasEntretenimento.lake.renderChat();
      salasEntretenimento.lake.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-sport').forEach(zone => {
    zone.addEventListener('click', () => {
      salasEntretenimento.sport.renderChat();
      salasEntretenimento.sport.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-culture').forEach(zone => {
    zone.addEventListener('click', () => {
      salasEntretenimento.culture.renderChat();
      salasEntretenimento.culture.modal.classList.remove('hidden');
    });
  });

  document.querySelectorAll('.zone-nerd').forEach(zone => {
    zone.addEventListener('click', () => {
      salasEntretenimento.nerd.renderChat();
      salasEntretenimento.nerd.modal.classList.remove('hidden');
    });
  });

  // Permitir enviar mensagem com Enter
  document.querySelectorAll('.chat-input input').forEach(input => {
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.target.nextElementSibling.click();
      }
    });
  });
});
</script>

<script>
// NPC JONAS - Sistema de Di√°logo
document.addEventListener('DOMContentLoaded', () => {
  const jonasModal = document.getElementById('jonasModal');
  const closeJonas = document.getElementById('closeJonas');
  
  // Sistema de di√°logo
  function setupNPCDialog() {
    const dialogButtons = document.querySelectorAll('.dialog-btn');
    
    dialogButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const nextStep = e.target.dataset.next;
        
        if (nextStep === 'end') {
          // Fechar modal se o usu√°rio conhece o JAX
          jonasModal.classList.add('hidden');
          resetDialog();
        } else {
          // Avan√ßar para pr√≥ximo passo do di√°logo
          showDialogStep(nextStep);
        }
      });
    });
  }
  
  function showDialogStep(stepId) {
    // Esconder todos os passos
    document.querySelectorAll('.dialog-step').forEach(step => {
      step.classList.add('hidden');
    });
    
    // Mostrar passo atual
    const currentStep = document.getElementById(stepId);
    if (currentStep) {
      currentStep.classList.remove('hidden');
      currentStep.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
  
  function resetDialog() {
    // Resetar para primeiro di√°logo
    showDialogStep('dialog1');
  }
  
  // Fechar modal
  closeJonas.addEventListener('click', () => {
    jonasModal.classList.add('hidden');
    resetDialog();
  });
  
  // Inicializar di√°logo
  setupNPCDialog();
  
  // Fun√ß√£o para abrir modal do Jonas (ser√° chamada pela colis√£o)
  window.openJonasDialog = function() {
    jonasModal.classList.remove('hidden');
    resetDialog();
  };
});
</script>

{% endblock %}
